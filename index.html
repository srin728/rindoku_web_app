<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<title>輪読用抽選アプリ</title>

	<style>
		:root {
			--bg: #0f172a;
			--panel: #1e293b;
			--text: #e5e7eb;
			--accent: #38bdf8;
			--danger: #f87171;
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			background: var(--bg);
			color: var(--text);
			font-family: "Inter", Arial, sans-serif;
		}

		.container {
			max-width: 760px;
			margin: 40px auto;
			padding: 30px;
		}

		.panel {
			background: var(--panel);
			border-radius: 14px;
			padding: 25px;
			margin-bottom: 30px;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
		}

		h1 {
			text-align: center;
			margin-bottom: 40px;
		}

		h2 {
			margin-top: 0;
			border-left: 4px solid var(--accent);
			padding-left: 10px;
		}

		.description {
			font-size: 0.9rem;
			line-height: 1.6;
			color: #cbd5f5;
			margin-bottom: 20px;
		}

		.item {
			display: grid;
			grid-template-columns: 1fr 90px 40px;
			gap: 10px;
			margin-bottom: 10px;
		}

		input {
			background: #020617;
			border: 1px solid #334155;
			color: var(--text);
			padding: 8px 10px;
			border-radius: 8px;
		}

		button {
			background: var(--accent);
			color: #020617;
			border: none;
			padding: 10px 16px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			margin-right: 8px;
		}

		button.secondary {
			background: #334155;
			color: var(--text);
		}

		button.danger {
			background: var(--danger);
			color: #020617;
		}

		button.delete {
			background: transparent;
			color: var(--danger);
			font-size: 1.2rem;
			padding: 0;
		}

		.result {
			margin-top: 20px;
			font-size: 1.4rem;
			font-weight: bold;
			color: var(--accent);
		}

		.timer-display {
			font-size: 2.5rem;
			font-weight: bold;
			text-align: center;
			margin: 15px 0;
		}
	</style>
</head>

<body>
	<div class="container">

		<h1>輪読用抽選アプリ</h1>

		<!-- 抽選 -->
		<div class="panel">
			<h2>抽選設定</h2>

			<div class="description">
				各行に「名前」と「重み」を入力してください。<br>
				<b>重みは相対的な当たりやすさ</b>を表します。<br>
				例えば、重み 3 の項目は、重み 1 の項目より
				<b>3 倍選ばれやすく</b>なります。<br>
				重みの合計が 100 である必要はありません。
			</div>

			<div id="items">
				<div class="item">
					<input type="text" value="A">
					<input type="number" value="3" min="0">
					<button class="delete" onclick="removeItem(this)">×</button>
				</div>
				<div class="item">
					<input type="text" value="B">
					<input type="number" value="3" min="0">
					<button class="delete" onclick="removeItem(this)">×</button>
				</div>
			</div>

			<button class="secondary" onclick="addItem()">＋ 項目追加</button>
			<button onclick="draw()">抽選</button>

			<div id="result" class="result"></div>
		</div>

		<!-- タイマー -->
		<div class="panel">
			<h2>タイマー</h2>

			<div class="description">
				測りたい時間（分・秒）を入力してスタートしてください。<br>
				時間が 0 になると音が鳴ります。
			</div>

			<div class="item" style="grid-template-columns: 1fr 1fr;">
				<input id="min" type="number" placeholder="分" min="0">
				<input id="sec" type="number" placeholder="秒" min="0" max="59">
			</div>

			<div class="timer-display" id="time">00:00</div>

			<button onclick="startTimer()">スタート</button>
			<button class="secondary" onclick="stopTimer()">ストップ</button>
			<button class="danger" onclick="resetTimer()">リセット</button>
		</div>

	</div>

	<script>
		/* 項目操作 */
		function addItem() {
			const div = document.createElement("div");
			div.className = "item";
			div.innerHTML = `
    <input type="text">
    <input type="number" value="3" min="0">
    <button class="delete" onclick="removeItem(this)">×</button>
  `;
			document.getElementById("items").appendChild(div);
		}

		function removeItem(btn) {
			btn.parentElement.remove();
		}

		/* 抽選 */
		function draw() {
			const items = document.querySelectorAll("#items .item");
			let total = 0, list = [];

			items.forEach(i => {
				const name = i.children[0].value;
				const w = Number(i.children[1].value);
				if (name && w > 0) {
					total += w;
					list.push({ name, w });
				}
			});

			if (total === 0) return;

			let r = Math.random() * total, sum = 0;
			for (const item of list) {
				sum += item.w;
				if (r < sum) {
					document.getElementById("result").textContent =
						"抽選結果: " + item.name;
					return;
				}
			}
		}

		/* タイマー + 音 */
		let timer = null;
		let remaining = 0;

		function beep() {
			const ctx = new AudioContext();
			const osc = ctx.createOscillator();
			const gain = ctx.createGain();
			osc.type = "sine";
			osc.frequency.value = 880;
			gain.gain.value = 0.2;
			osc.connect(gain).connect(ctx.destination);
			osc.start();
			osc.stop(ctx.currentTime + 0.5);
		}

		function updateDisplay() {
			const m = String(Math.floor(remaining / 60)).padStart(2, "0");
			const s = String(remaining % 60).padStart(2, "0");
			document.getElementById("time").textContent = `${m}:${s}`;
		}

		function startTimer() {
			if (timer) return;

			if (remaining === 0) {
				const m = Number(min.value) || 0;
				const s = Number(sec.value) || 0;
				remaining = m * 60 + s;
				if (remaining === 0) return;
			}

			updateDisplay();
			timer = setInterval(() => {
				remaining--;
				updateDisplay();
				if (remaining <= 0) {
					stopTimer();
					document.getElementById("time").textContent = "TIME UP";
					beep();
				}
			}, 1000);
		}

		function stopTimer() {
			clearInterval(timer);
			timer = null;
		}

		function resetTimer() {
			stopTimer();
			remaining = 0;
			document.getElementById("time").textContent = "00:00";
		}
	</script>

</body>

</html>